#!/bin/bash -e

# Regenerates src/project/ConfigJson.sk from src/project/ProjectConfig.sk
# This is manual because the input scheme will rarely change and making it manual
# removes skip_serialization_generator from the dependencies when iterating on the compiler.

ninja -C build skip_serialization_generator skip_printer
TMP_FILE=$(mktemp)
echo $TMP_FILE
echo '// NOTE: This file is generated by tools/generate_project_config. Do not edit it.' > $TMP_FILE
build/bin/skip_serialization_generator < src/project/ProjectConfig.sk >> $TMP_FILE
build/bin/skip_printer --write $TMP_FILE
cp $TMP_FILE src/project/ConfigSerialization.sk
